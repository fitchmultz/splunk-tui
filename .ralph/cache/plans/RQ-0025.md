# Strategic Implementation Plan: System-Wide Health Check API Client (RQ-0025)

## 1. PRE-FLIGHT
- **Verification:** Ensure the current workspace is clean (`git status`).
- **Dependencies:** No new external crates required; will use `serde`, `serde_json`, and `HashMap`.

## 2. SURGICAL MODIFICATIONS

### PHASE A: DATA FOUNDATION
1. **Fixture Creation:**
   - Create `crates/client/fixtures/server/get_health.json`.
   - Content will mirror the Splunk `/services/server/health/splunkd` JSON response, including features like `KVStore`, `SearchScheduler`, and `IndexProcessor`.

2. **Model Definition (`crates/client/src/models.rs`):**
   - Import `std::collections::HashMap`.
   - Define `HealthFeature` struct with `health`, `status`, `disabled`, and `reasons` fields.
   - Define `SplunkHealth` struct with `health` and `features` (as `HashMap<String, HealthFeature>`).
   - Use `#[derive(Debug, Deserialize, Clone)]` for all new models.

### PHASE B: ENDPOINT & CLIENT LOGIC
3. **Endpoint Implementation (`crates/client/src/endpoints/server.rs`):**
   - Implement `get_health` function following the `get_server_info` pattern.
   - Target URL: `/services/server/health/splunkd`.
   - Extract content from the first entry of the Splunk Atom feed response.

4. **Endpoint Export (`crates/client/src/endpoints/mod.rs`):**
   - Re-export `get_health` from the `server` module.

5. **Client Method (`crates/client/src/client.rs`):**
   - Implement `SplunkClient::get_health(&mut self) -> Result<SplunkHealth>`.
   - Include session expiration handling (401/403) and retry logic consistent with other client methods.

### PHASE C: VERIFICATION & QUALITY
6. **Integration Testing (`crates/client/tests/integration_tests.rs`):**
   - Add `test_get_health` async test.
   - Use `MockServer` to mock the `/services/server/health/splunkd` endpoint.
   - Use `load_fixture` to load the new JSON mock response.
   - Assert correct parsing of overall health and specific feature status.

## 3. POST-FLIGHT OPERATIONS
- **Linting & Formatting:** Run `cargo fmt` and `cargo clippy`.
- **Validation:** Execute `cargo test -p splunk-client` and `make ci` to ensure no regressions.
- **Queue Completion:** Move `RQ-0025` to `.ralph/done.json` and update `.ralph/queue.json`.
- **Commit:** `RQ-0025: Implement system-wide health check API client`.