{
  "version": 1,
  "tasks": [
    {
      "id": "RQ-0309",
      "status": "todo",
      "title": "Refactor SplunkClient search APIs to avoid too-many-arguments and clarify options",
      "priority": "high",
      "tags": [
        "maintenance"
      ],
      "scope": [
        "crates/client/src/client/search.rs",
        "crates/client/src/endpoints/search",
        "cargo clippy --workspace --all-targets --all-features -- -D warnings"
      ],
      "evidence": [
        "crates/client/src/client/search.rs:33-75 `SplunkClient::search` takes 8 args and triggers clippy `too_many_arguments`.",
        "crates/client/src/client/search.rs:99-144 `SplunkClient::search_with_progress` takes 9 args and triggers the same clippy error.",
        "cmd: cargo clippy --workspace --all-targets --all-features --locked -- -D warnings -> fails on these functions."
      ],
      "plan": [
        "Introduce a `SearchOptions`/`SearchRequest` struct (or reuse CreateJobOptions) to bundle parameters",
        "Update CLI/TUI call sites to pass the options struct",
        "Keep a compatibility layer only if required; otherwise make an explicit breaking change",
        "Add tests verifying search option mapping and default behavior",
        "Verify by running `cargo clippy --workspace --all-targets --all-features -- -D warnings` and `cargo test -p splunk-client`"
      ],
      "notes": [],
      "request": "maintenance scan finding",
      "created_at": "2026-02-03T00:36:01Z",
      "updated_at": "2026-02-03T00:36:01Z",
      "depends_on": [],
      "blocks": [],
      "relates_to": [],
      "custom_fields": {
        "scan_agent": "scan-maintenance"
      }
    },
    {
      "id": "RQ-0310",
      "status": "todo",
      "title": "Remove dummy Config construction in `splunk-cli list-all` dispatch (make illegal states unrepresentable)",
      "priority": "medium",
      "tags": [
        "maintenance",
        "reliability"
      ],
      "scope": [
        "crates/cli/src/dispatch.rs",
        "crates/cli/src/commands/list_all",
        "cargo test -p splunk-cli"
      ],
      "evidence": [
        "crates/cli/src/dispatch.rs:268-295 constructs a placeholder `splunk_config::Config` with empty base_url and empty secrets in multi-profile mode, relying on a comment that it is unused.",
        "This creates an illegal-but-representable state: a `Config` value that would crash/fail if accidentally used in future code paths."
      ],
      "plan": [
        "Refactor `commands::list_all::run` to accept `Option<Config>` or split into single-profile vs multi-profile entrypoints",
        "Eliminate placeholder config creation and enforce invariants at the type boundary",
        "Add tests for list-all multi-profile path to ensure no dummy config is needed",
        "Verify by running `cargo test -p splunk-cli` and `make ci`"
      ],
      "notes": [],
      "request": "maintenance scan finding",
      "created_at": "2026-02-03T00:36:01Z",
      "updated_at": "2026-02-03T00:36:01Z",
      "depends_on": [],
      "blocks": [],
      "relates_to": [],
      "custom_fields": {
        "scan_agent": "scan-maintenance"
      }
    },
    {
      "id": "RQ-0311",
      "status": "todo",
      "title": "Validate `base_url` during config build (fail fast with clear error)",
      "priority": "medium",
      "tags": [
        "maintenance",
        "correctness"
      ],
      "scope": [
        "crates/config/src/loader/builder.rs",
        "crates/config/src/loader/error.rs",
        "crates/config/src/loader/tests",
        "cargo test -p splunk-config"
      ],
      "evidence": [
        "crates/config/src/loader/builder.rs:194-219 accepts `base_url` as an opaque string and does not validate scheme/host/format.",
        "crates/config/src/loader/error.rs:22-61 lacks an InvalidBaseUrl-style error variant; invalid URLs likely fail later in HTTP code with less actionable errors."
      ],
      "plan": [
        "Add URL parsing/validation in ConfigLoader::build (e.g., require http/https and a host)",
        "Add a dedicated ConfigError variant for invalid base URLs with actionable messaging",
        "Extend tests to cover invalid/whitespace base_url inputs and ensure errors are returned at build time",
        "Verify by running `cargo test -p splunk-config` and a smoke `splunk-cli health` with a bad URL"
      ],
      "notes": [],
      "request": "maintenance scan finding",
      "created_at": "2026-02-03T00:36:01Z",
      "updated_at": "2026-02-03T00:36:01Z",
      "depends_on": [],
      "blocks": [],
      "relates_to": [],
      "custom_fields": {
        "scan_agent": "scan-maintenance"
      }
    },
    {
      "id": "RQ-0312",
      "status": "todo",
      "title": "Trim env var values in `env_var_or_none` to match documented invariants",
      "priority": "medium",
      "tags": [
        "maintenance",
        "correctness"
      ],
      "scope": [
        "crates/config/src/loader/env.rs",
        "crates/config/src/loader/tests/env_tests.rs",
        "cargo test -p splunk-config"
      ],
      "evidence": [
        "crates/config/src/loader/env.rs:25-27 claims whitespace-only values are treated as unset, but returns the original string without trimming.",
        "crates/config/src/loader/env.rs:33-44 applies untrimmed base_url/username/password/token values; e.g., `SPLUNK_BASE_URL=' https://... '` would be accepted and likely fail later."
      ],
      "plan": [
        "Change env_var_or_none to return a trimmed string (or add a separate helper for raw vs trimmed)",
        "Add tests covering leading/trailing whitespace for SPLUNK_BASE_URL and SPLUNK_USERNAME",
        "Verify by running `cargo test -p splunk-config`"
      ],
      "notes": [],
      "request": "maintenance scan finding",
      "created_at": "2026-02-03T00:36:01Z",
      "updated_at": "2026-02-03T00:36:01Z",
      "depends_on": [],
      "blocks": [],
      "relates_to": [],
      "custom_fields": {
        "scan_agent": "scan-maintenance"
      }
    },
    {
      "id": "RQ-0313",
      "status": "todo",
      "title": "Surface dotenv load failures (don't silently ignore invalid `.env` files)",
      "priority": "medium",
      "tags": [
        "maintenance",
        "operability"
      ],
      "scope": [
        "crates/config/src/loader/builder.rs",
        "crates/config/src/loader/tests",
        "cargo test -p splunk-config"
      ],
      "evidence": [
        "crates/config/src/loader/builder.rs:88-94 calls `dotenvy::dotenv().ok();`, swallowing parse errors and making misconfigurations harder to debug."
      ],
      "plan": [
        "Differentiate missing `.env` (OK) vs invalid `.env` (error or at least warn with context)",
        "Ensure DOTENV_DISABLED behavior remains hermetic for tests",
        "Add tests that invalid `.env` content produces a clear failure mode when dotenv loading is enabled",
        "Verify by running `cargo test -p splunk-config` and `make ci`"
      ],
      "notes": [],
      "request": "maintenance scan finding",
      "created_at": "2026-02-03T00:36:01Z",
      "updated_at": "2026-02-03T00:36:01Z",
      "depends_on": [],
      "blocks": [],
      "relates_to": [],
      "custom_fields": {
        "scan_agent": "scan-maintenance"
      }
    },
    {
      "id": "RQ-0314",
      "status": "todo",
      "title": "Remove duplicate timeout flags in `splunk-cli config set` help output",
      "priority": "low",
      "tags": [
        "maintenance",
        "ux"
      ],
      "scope": [
        "crates/cli/src/args.rs",
        "crates/cli/src/commands/config.rs",
        "crates/cli/tests",
        "cargo test -p splunk-cli"
      ],
      "evidence": [
        "cmd: splunk-cli config set --help -> shows both `--timeout` (global, env SPLUNK_TIMEOUT) and `--timeout-seconds` (config set) with the same meaning, which is confusing.",
        "crates/cli/src/args.rs:42-44 defines global `--timeout` (env SPLUNK_TIMEOUT).",
        "crates/cli/src/commands/config.rs:53-56 defines `--timeout-seconds` on `config set`."
      ],
      "plan": [
        "Pick a single timeout flag naming scheme for config set (e.g., reuse global `--timeout`, or rename global to `--connect-timeout` and hide it where appropriate)",
        "Update clap definitions so `splunk-cli config set --help` shows only one timeout option",
        "Add/adjust a help-output test for the config subcommand",
        "Verify by running `cargo test -p splunk-cli` and checking `splunk-cli config set --help` output"
      ],
      "notes": [],
      "request": "maintenance scan finding",
      "created_at": "2026-02-03T00:36:01Z",
      "updated_at": "2026-02-03T00:36:01Z",
      "depends_on": [],
      "blocks": [],
      "relates_to": [],
      "custom_fields": {
        "scan_agent": "scan-maintenance"
      }
    }
  ]
}