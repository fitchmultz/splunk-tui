{
  "version": 1,
  "tasks": [
    {
      "id": "RQ-0335",
      "status": "todo",
      "title": "Sanitize persisted SearchDefaults invariants on load (max_results >= 1, non-empty times)",
      "priority": "medium",
      "tags": [
        "maintenance",
        "config",
        "correctness",
        "tui"
      ],
      "scope": [
        "crates/config/src/persistence/state.rs",
        "crates/config/src/persistence/profiles.rs",
        "crates/tui/src/runtime/side_effects/searches.rs",
        "make test"
      ],
      "evidence": [
        "crates/config/src/persistence/state.rs:39-42 documents invariants for `SearchDefaults` (max_results >= 1), but the type is plain data with no validation hook.",
        "crates/tui/src/runtime/side_effects/searches.rs:61-79 performs runtime sanitization and warns when earliest/latest are empty or `max_results == 0`, proving invalid persisted values are representable and can reach runtime."
      ],
      "plan": [
        "Add a `SearchDefaults::sanitize()` (or equivalent) in `crates/config` and call it when loading persisted state (ConfigManager load path)",
        "Add unit tests covering empty earliest/latest and max_results=0 cases to ensure they normalize to defaults",
        "Remove or downgrade runtime fallback warnings in TUI once invariants are enforced at the config boundary",
        "Verify by running `cargo test --workspace --all-targets --all-features --locked`"
      ],
      "notes": [
        "Principles violated: E (Make bugs hard to write), F (Fail fast appropriately), C (DRY).",
        "Why it matters: illegal states (empty times, max_results=0) make it to runtime, forcing defensive code and producing inconsistent behavior depending on where the defaults were applied.",
        "Minimal fix: enforce invariants in config loading/persistence so downstream code can assume validated defaults.",
        "Acceptance criteria: persisted invalid values are normalized at load time; TUI no longer needs to warn+patch these invariants at run-search time; `make test` passes."
      ],
      "request": "maintenance scan finding",
      "created_at": "2026-02-05T01:56:01Z",
      "updated_at": "2026-02-05T01:56:01Z",
      "depends_on": [],
      "blocks": [],
      "relates_to": [],
      "custom_fields": {
        "scan_agent": "scan-maintenance"
      }
    },
    {
      "id": "RQ-0336",
      "status": "todo",
      "title": "Cache footer_hints to avoid per-frame keybinding catalog allocations",
      "priority": "low",
      "tags": [
        "maintenance",
        "tui",
        "performance"
      ],
      "scope": [
        "crates/tui/src/app/render.rs",
        "crates/tui/src/input/keymap/mod.rs",
        "make test"
      ],
      "evidence": [
        "crates/tui/src/app/render.rs:701-734 calls `footer_hints(self.current_screen)` on every render to build footer text.",
        "crates/tui/src/input/keymap/mod.rs:132-170 recomputes footer hints by calling `keybindings()` (allocates a Vec at crates/tui/src/input/keymap/mod.rs:101-103) and uses a `BTreeSet` plus sorting per call."
      ],
      "plan": [
        "Memoize `footer_hints` results per `CurrentScreen` (e.g., `LazyLock<HashMap<CurrentScreen, Vec<_>>>`) while preserving determinism",
        "Add tests asserting `footer_hints(screen)` output is stable and matches expected hints for a representative subset of screens",
        "Verify by running `cargo test -p splunk-tui`"
      ],
      "notes": [
        "Principles violated: A (KISS in runtime hot paths), H (Operational hygiene).",
        "Why it matters: per-frame allocations and sorting work in the render loop can degrade responsiveness on slower terminals and complicate performance tuning.",
        "Minimal fix: cache computed hints and reuse them; invalidation only needs to happen when keybinding overrides change.",
        "Acceptance criteria: render loop no longer allocates/sorts footer hints each frame; behavior remains identical; `make test` passes."
      ],
      "request": "maintenance scan finding",
      "created_at": "2026-02-05T01:56:01Z",
      "updated_at": "2026-02-05T01:56:01Z",
      "depends_on": [],
      "blocks": [],
      "relates_to": [],
      "custom_fields": {
        "scan_agent": "scan-maintenance"
      }
    }
  ]
}