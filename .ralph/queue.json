{
  "version": 1,
  "tasks": [
    {
      "id": "RQ-0331",
      "status": "todo",
      "title": "Sync search pagination page size with configured SearchDefaults.max_results",
      "priority": "high",
      "tags": [
        "maintenance",
        "tui",
        "correctness",
        "pagination"
      ],
      "scope": [
        "crates/tui/src/app/core.rs",
        "crates/tui/src/app.rs",
        "crates/tui/src/runtime/side_effects/searches.rs",
        "crates/tui/src/ui/screens/settings.rs",
        "make test"
      ],
      "evidence": [
        "crates/tui/src/app/core.rs:118-142 initializes `search_results_page_size` to `DEFAULT_SEARCH_PAGE_SIZE` regardless of persisted `search_defaults`.",
        "crates/tui/src/app.rs:358-377 uses `search_results_page_size` as the `count` for `Action::LoadMoreSearchResults` (line 373).",
        "crates/tui/src/runtime/side_effects/searches.rs:61-79 uses `search_defaults.max_results` to build the Splunk `SearchRequest` (line 99), so the request page size can diverge from the UI's pagination assumptions.",
        "Command: `rg -n \"search_results_page_size\" crates/tui/src -g'*.rs'` shows no runtime updates to `search_results_page_size` outside initialization/tests."
      ],
      "plan": [
        "Treat `SearchDefaults.max_results` as the single source of truth for search pagination size",
        "Update app initialization and settings updates to set `search_results_page_size = search_defaults.max_results` (with validation for zero/invalid values)",
        "Adjust has-more inference for `total=None` to use the actual page size used for the request",
        "Add tests for pagination/count behavior and verify by running `cargo test -p splunk-tui`"
      ],
      "notes": [
        "Principles violated: C (DRY), E (Make bugs hard to write), G (Least astonishment).",
        "Why it matters: when UI pagination `count` diverges from the request `max_results`, the TUI can over/under-fetch, miscompute `has_more_results` when total is unknown, and behave inconsistently with configured defaults.",
        "Minimal fix: unify on `SearchDefaults.max_results` and update the app state whenever the configured value changes; enforce `>= 1` invariant at the boundary.",
        "Acceptance criteria: pagination uses the same page size as the last search request; regression tests cover both `total=Some` and `total=None` cases; `make test` passes."
      ],
      "request": "maintenance scan finding",
      "created_at": "2026-02-05T01:56:01Z",
      "updated_at": "2026-02-05T01:56:01Z",
      "depends_on": [],
      "blocks": [],
      "relates_to": [],
      "custom_fields": {
        "scan_agent": "scan-maintenance"
      }
    },
    {
      "id": "RQ-0332",
      "status": "todo",
      "title": "Add drift-prevention test: footer hint priority keys must exist in keymap catalog",
      "priority": "medium",
      "tags": [
        "maintenance",
        "tui",
        "tests",
        "keybindings"
      ],
      "scope": [
        "crates/tui/src/input/keymap/mod.rs",
        "make test"
      ],
      "evidence": [
        "crates/tui/src/input/keymap/mod.rs:293-325 defines `priority_keys` lists (e.g., Macros includes `d` and `Ctrl+c` at line 306).",
        "crates/tui/src/input/keymap/bindings/screens/macros.rs:15-55 does not contain entries for `d` or `Ctrl+c`, so prioritization cannot actually surface those hints."
      ],
      "plan": [
        "Add a unit test in `crates/tui/src/input/keymap/mod.rs` that asserts every `priority_keys` entry exists in the keybinding catalog for that screen/section",
        "Fix any failing screens by adding missing keybinding metadata or adjusting priority lists to match reality",
        "Verify by running `cargo test -p splunk-tui`"
      ],
      "notes": [
        "Principles violated: C (DRY), H (Operational hygiene).",
        "Why it matters: the footer hint priority lists are manual and can drift from the authoritative keybinding catalog; a test makes this class of bug hard to reintroduce.",
        "Minimal fix: enforce consistency via unit tests (and treat missing keys as a failing invariant).",
        "Acceptance criteria: the new test passes; adding/removing a prioritized key requires updating the catalog or the list explicitly; `make test` passes."
      ],
      "request": "maintenance scan finding",
      "created_at": "2026-02-05T01:56:01Z",
      "updated_at": "2026-02-05T01:56:01Z",
      "depends_on": [],
      "blocks": [],
      "relates_to": [],
      "custom_fields": {
        "scan_agent": "scan-maintenance"
      }
    },
    {
      "id": "RQ-0333",
      "status": "todo",
      "title": "Deduplicate overview resource fetchers shared by Overview and Multi-Instance screens",
      "priority": "medium",
      "tags": [
        "maintenance",
        "tui",
        "dry",
        "runtime"
      ],
      "scope": [
        "crates/tui/src/runtime/side_effects/overview.rs",
        "crates/tui/src/runtime/side_effects/multi_instance.rs",
        "make test"
      ],
      "evidence": [
        "crates/tui/src/runtime/side_effects/overview.rs:87-175 defines `resource_error` and `fetch_indexes/jobs/apps/users` with identical shapes and constants.",
        "crates/tui/src/runtime/side_effects/multi_instance.rs:218-321 defines a duplicate `resource_error` and duplicate `fetch_jobs/indexes/apps/users` with the same logic."
      ],
      "plan": [
        "Extract shared OverviewResource fetch helpers into a new internal module (e.g., `crates/tui/src/runtime/side_effects/overview_fetch.rs`)",
        "Update both Overview and Multi-Instance side effect handlers to use the shared helpers",
        "Add focused unit tests for the helper functions (e.g., timeout mapping -> `ClientError::Timeout`) without mocking",
        "Verify by running `cargo test -p splunk-tui`"
      ],
      "notes": [
        "Principles violated: C (DRY), D (Localize change).",
        "Why it matters: duplicated async timeout + error mapping logic increases the chance of inconsistent behavior and makes future changes (timeouts, limits, error handling) require edits in multiple places.",
        "Minimal fix: extract and reuse a shared helper module with tests, keeping the public API private (`pub(crate)` at most).",
        "Acceptance criteria: no duplicated fetch helpers remain across these modules; tests cover the shared helper behavior; `make test` passes."
      ],
      "request": "maintenance scan finding",
      "created_at": "2026-02-05T01:56:01Z",
      "updated_at": "2026-02-05T01:56:01Z",
      "depends_on": [],
      "blocks": [],
      "relates_to": [],
      "custom_fields": {
        "scan_agent": "scan-maintenance"
      }
    },
    {
      "id": "RQ-0334",
      "status": "todo",
      "title": "Replace overview/multi-instance magic timeouts and list limits with shared constants",
      "priority": "medium",
      "tags": [
        "maintenance",
        "tui",
        "consistency",
        "performance"
      ],
      "scope": [
        "crates/tui/src/runtime/side_effects/overview.rs",
        "crates/tui/src/runtime/side_effects/multi_instance.rs",
        "crates/tui/src/app.rs",
        "make test"
      ],
      "evidence": [
        "crates/tui/src/runtime/side_effects/overview.rs:100-174 repeats `Duration::from_secs(30)` and hard-coded list limits (indexes/apps/users use `Some(1000)`, jobs use `Some(100)`).",
        "crates/tui/src/runtime/side_effects/multi_instance.rs:228-321 repeats the same timeout and limits.",
        "crates/tui/src/app.rs:483-492 defines an unrelated hard-coded loading timeout of 30 seconds, with a hard-coded message string."
      ],
      "plan": [
        "Introduce shared constants for \"overview fetch timeout\" and per-resource list limits (or wire them to config defaults where appropriate)",
        "Apply the constants consistently across overview + multi-instance fetchers and loading timeout messaging",
        "Add tests that validate the constants are used (behavioral tests via timeout mapping and page-size usage)",
        "Verify by running `cargo test -p splunk-tui`"
      ],
      "notes": [
        "Principles violated: C (DRY), D (Localize change), H (Operational hygiene).",
        "Why it matters: hard-coded magic numbers scattered across the runtime make it easy for limits/timeouts to diverge, and the user-visible timeout message can become incorrect if only one value is changed.",
        "Minimal fix: centralize the constants (prefer `splunk_config::constants` if broadly applicable) and reference them everywhere they apply.",
        "Acceptance criteria: timeouts and list limits are defined once and used consistently; user-visible timeout messaging matches the configured value; `make test` passes."
      ],
      "request": "maintenance scan finding",
      "created_at": "2026-02-05T01:56:01Z",
      "updated_at": "2026-02-05T01:56:01Z",
      "depends_on": [
        "RQ-0333"
      ],
      "blocks": [],
      "relates_to": [],
      "custom_fields": {
        "scan_agent": "scan-maintenance"
      }
    },
    {
      "id": "RQ-0335",
      "status": "todo",
      "title": "Sanitize persisted SearchDefaults invariants on load (max_results >= 1, non-empty times)",
      "priority": "medium",
      "tags": [
        "maintenance",
        "config",
        "correctness",
        "tui"
      ],
      "scope": [
        "crates/config/src/persistence/state.rs",
        "crates/config/src/persistence/profiles.rs",
        "crates/tui/src/runtime/side_effects/searches.rs",
        "make test"
      ],
      "evidence": [
        "crates/config/src/persistence/state.rs:39-42 documents invariants for `SearchDefaults` (max_results >= 1), but the type is plain data with no validation hook.",
        "crates/tui/src/runtime/side_effects/searches.rs:61-79 performs runtime sanitization and warns when earliest/latest are empty or `max_results == 0`, proving invalid persisted values are representable and can reach runtime."
      ],
      "plan": [
        "Add a `SearchDefaults::sanitize()` (or equivalent) in `crates/config` and call it when loading persisted state (ConfigManager load path)",
        "Add unit tests covering empty earliest/latest and max_results=0 cases to ensure they normalize to defaults",
        "Remove or downgrade runtime fallback warnings in TUI once invariants are enforced at the config boundary",
        "Verify by running `cargo test --workspace --all-targets --all-features --locked`"
      ],
      "notes": [
        "Principles violated: E (Make bugs hard to write), F (Fail fast appropriately), C (DRY).",
        "Why it matters: illegal states (empty times, max_results=0) make it to runtime, forcing defensive code and producing inconsistent behavior depending on where the defaults were applied.",
        "Minimal fix: enforce invariants in config loading/persistence so downstream code can assume validated defaults.",
        "Acceptance criteria: persisted invalid values are normalized at load time; TUI no longer needs to warn+patch these invariants at run-search time; `make test` passes."
      ],
      "request": "maintenance scan finding",
      "created_at": "2026-02-05T01:56:01Z",
      "updated_at": "2026-02-05T01:56:01Z",
      "depends_on": [],
      "blocks": [],
      "relates_to": [],
      "custom_fields": {
        "scan_agent": "scan-maintenance"
      }
    },
    {
      "id": "RQ-0336",
      "status": "todo",
      "title": "Cache footer_hints to avoid per-frame keybinding catalog allocations",
      "priority": "low",
      "tags": [
        "maintenance",
        "tui",
        "performance"
      ],
      "scope": [
        "crates/tui/src/app/render.rs",
        "crates/tui/src/input/keymap/mod.rs",
        "make test"
      ],
      "evidence": [
        "crates/tui/src/app/render.rs:701-734 calls `footer_hints(self.current_screen)` on every render to build footer text.",
        "crates/tui/src/input/keymap/mod.rs:132-170 recomputes footer hints by calling `keybindings()` (allocates a Vec at crates/tui/src/input/keymap/mod.rs:101-103) and uses a `BTreeSet` plus sorting per call."
      ],
      "plan": [
        "Memoize `footer_hints` results per `CurrentScreen` (e.g., `LazyLock<HashMap<CurrentScreen, Vec<_>>>`) while preserving determinism",
        "Add tests asserting `footer_hints(screen)` output is stable and matches expected hints for a representative subset of screens",
        "Verify by running `cargo test -p splunk-tui`"
      ],
      "notes": [
        "Principles violated: A (KISS in runtime hot paths), H (Operational hygiene).",
        "Why it matters: per-frame allocations and sorting work in the render loop can degrade responsiveness on slower terminals and complicate performance tuning.",
        "Minimal fix: cache computed hints and reuse them; invalidation only needs to happen when keybinding overrides change.",
        "Acceptance criteria: render loop no longer allocates/sorts footer hints each frame; behavior remains identical; `make test` passes."
      ],
      "request": "maintenance scan finding",
      "created_at": "2026-02-05T01:56:01Z",
      "updated_at": "2026-02-05T01:56:01Z",
      "depends_on": [],
      "blocks": [],
      "relates_to": [],
      "custom_fields": {
        "scan_agent": "scan-maintenance"
      }
    }
  ]
}