{
  "version": 1,
  "tasks": [
    {
      "id": "RQ-0409",
      "status": "todo",
      "title": "Create macro or wrapper for tokio::select! cancellation pattern",
      "description": "The tokio::select! cancellation pattern is repeated 60+ times across CLI command files with nearly identical code. This pattern combines an API call with a cancellation token check. Create a macro or wrapper function to handle this consistently and reduce code duplication.",
      "priority": "low",
      "tags": [
        "maintenance",
        "dry",
        "refactoring",
        "cli"
      ],
      "scope": [
        "crates/cli/src/commands/jobs.rs",
        "crates/cli/src/commands/cluster.rs",
        "crates/cli/src/commands/license.rs",
        "crates/cli/src/commands/*.rs"
      ],
      "evidence": [
        "Pattern repeated 60+ times:",
        "let result = tokio::select! {",
        "    res = client.some_api_call() => res?;",
        "    _ = cancel.cancelled() => return Err(Cancelled.into());",
        "};"
      ],
      "plan": [
        "Create a macro like retry_call! for cancellation handling",
        "Or create a wrapper function that takes a future and cancellation token",
        "Refactor all 60+ occurrences to use the new abstraction",
        "Ensure the abstraction preserves error types correctly",
        "Verify by running `make ci`"
      ],
      "notes": [],
      "request": "maintenance scan finding",
      "created_at": "2026-02-07T14:43:17Z",
      "updated_at": "2026-02-07T14:43:17Z",
      "depends_on": [],
      "blocks": [],
      "relates_to": [],
      "custom_fields": {
        "scan_agent": "scan-maintenance"
      }
    },
    {
      "id": "RQ-0410",
      "status": "todo",
      "title": "Create shared form parameter builder for endpoint modules",
      "description": "Endpoint modules repeat the same pattern for building form parameters with repetitive if let Some() blocks. This pattern appears 20+ times across endpoint files with slight variations. Create a macro or builder pattern to reduce this duplication.",
      "priority": "low",
      "tags": [
        "maintenance",
        "dry",
        "refactoring",
        "client"
      ],
      "scope": [
        "crates/client/src/endpoints/indexes.rs",
        "crates/client/src/endpoints/users.rs",
        "crates/client/src/endpoints/roles.rs"
      ],
      "evidence": [
        "Pattern repeated with slight variations:",
        "if let Some(max_data_size) = params.max_data_size_mb {",
        "    form_params.push(('maxTotalDataSizeMB'.to_string(), max_data_size.to_string()));",
        "}",
        "Duplicated within indexes.rs at lines 70-96 and 153-179"
      ],
      "plan": [
        "Create a macro or helper for form parameter construction",
        "Helper should handle Option<T> to form param conversion",
        "Handle serde rename attribute lookup automatically if possible",
        "Refactor endpoint files to use the helper",
        "Verify by running `make ci`"
      ],
      "notes": [],
      "request": "maintenance scan finding",
      "created_at": "2026-02-07T14:43:17Z",
      "updated_at": "2026-02-07T14:43:17Z",
      "depends_on": [],
      "blocks": [],
      "relates_to": [],
      "custom_fields": {
        "scan_agent": "scan-maintenance"
      }
    },
    {
      "id": "RQ-0411",
      "status": "todo",
      "title": "Fix timestamp formatting in error_details.rs to use proper time formatting",
      "description": "The error_details.rs file uses format!(\"{:?}\", std::time::SystemTime::now()) for timestamp serialization, which produces a Debug representation instead of a properly formatted timestamp. Replace with chrono for consistent, readable timestamps.",
      "priority": "low",
      "tags": [
        "maintenance",
        "type-safety",
        "operability",
        "tui"
      ],
      "scope": [
        "crates/tui/src/error_details.rs"
      ],
      "evidence": [
        "Line 45: timestamp: format!(\"{:?}\", std::time::SystemTime::now())",
        "Uses Debug format instead of proper time formatting",
        "Produces timestamps like 'SystemTime { tv_sec: 1234567890, tv_nsec: 123456789 }'",
        "Should use ISO 8601 or RFC 3339 format"
      ],
      "plan": [
        "Replace SystemTime::now() with chrono::Local::now() or chrono::Utc::now()",
        "Use to_rfc3339() or custom format string for readable timestamps",
        "Update any tests that depend on timestamp format",
        "Verify by running `make ci`"
      ],
      "notes": [],
      "request": "maintenance scan finding",
      "created_at": "2026-02-07T14:43:17Z",
      "updated_at": "2026-02-07T14:43:17Z",
      "depends_on": [],
      "blocks": [],
      "relates_to": [],
      "custom_fields": {
        "scan_agent": "scan-maintenance"
      }
    }
  ]
}