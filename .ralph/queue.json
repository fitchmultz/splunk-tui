{
  "version": 1,
  "tasks": [
    {
      "id": "RQ-0091",
      "status": "todo",
      "title": "Add color scheme customization to TUI",
      "priority": "low",
      "tags": [
        "tui",
        "ux",
        "customization",
        "accessibility"
      ],
      "scope": [
        "crates/tui/src/app.rs",
        "crates/tui/src/ui/screens/jobs.rs",
        "crates/tui/src/ui/screens/internal_logs.rs",
        "crates/tui/src/ui/screens/job_details.rs",
        "crates/tui/src/ui/screens/saved_searches.rs",
        "crates/tui/src/ui/screens/indexes.rs",
        "crates/tui/src/ui/screens/users.rs",
        "crates/tui/src/ui/screens/apps.rs",
        "crates/tui/src/ui/screens/search.rs",
        "crates/tui/src/ui/screens/cluster.rs",
        "crates/tui/src/ui/screens/health.rs",
        "crates/tui/src/ui/screens/settings.rs",
        "crates/tui/src/ui/toast.rs",
        "crates/tui/src/ui/popup.rs",
        "crates/tui/src/ui/error_details.rs",
        "crates/tui/src/ui/syntax.rs",
        "crates/config/src/types.rs",
        "crates/config/src/persistence.rs",
        "docs/usage.md"
      ],
      "evidence": [
        "TUI has 139 instances of hardcoded Color:: usage across 17 UI screens (e.g., jobs.rs, internal_logs.rs, search.rs, settings.rs)",
        "No existing theme infrastructure found in codebase (search for 'theme|ColorScheme' returns 0 matches in implementation)",
        "Settings screen (RQ-0083) is already implemented in crates/tui/src/ui/screens/settings.rs, providing a location for theme selection UI",
        "Specific hardcoded color patterns remain: job status colors (Green/Yellow/Red), log level colors, toast notification colors, health state colors, selection colors (Yellow highlight), and label colors (Cyan)",
        "PersistedState in crates/config/src/persistence.rs defines 5 fields (auto_refresh, sort_column, sort_direction, last_search_query, search_history) but no theme-related field exists",
        "Config types in crates/config/src/types.rs have AuthConfig, ConnectionConfig, ProfileConfig but no theme or color-related types exist",
        "docs/usage.md documents keyboard shortcuts for the Settings screen but lacks theme customization documentation",
        "ratatui is already imported across all UI screens (use ratatui::style::{Color, Style, Modifier} pattern confirmed in 14 screen files)",
        "Color usage patterns are consistent but inflexible across all render functions"
      ],
      "plan": [
        "Add ColorScheme enum to crates/tui/src/app.rs with variants (Default, Light, Dark, HighContrast) and impl for str conversion",
        "Create Theme struct in crates/config/src/types.rs with color fields for UI elements: header_fg, footer_fg, table_header_fg, selection_bg, selection_fg, status_done, status_running, status_failed, log_error, log_warn, log_info, log_debug, toast_info, toast_success, toast_warn, toast_error, health_healthy, health_unhealthy, health_unknown",
        "Add ColorTheme enum to crates/config/src/types.rs with predefined color schemes (DefaultTheme, LightTheme, DarkTheme, HighContrastTheme) each implementing Into<Theme>",
        "Extend PersistedState in crates/config/src/persistence.rs with theme field (String, default 'default')",
        "Update App struct in crates/tui/src/app.rs: add theme field with ColorScheme, initialize from PersistedState.theme, and add get_theme() method returning Theme based on current scheme",
        "Refactor hardcoded Color:: values in all UI screen modules (jobs.rs, internal_logs.rs, job_details.rs, etc.) to use app.theme fields",
        "Refactor syntax.rs to use theme-based colors for SPL syntax highlighting",
        "Update settings.rs to include a 'Theme' display row showing current scheme name",
        "Add theme switching logic to Settings screen: handle 't' key to cycle through schemes and update current app theme",
        "Update App::get_persisted_state() to include theme field in the returned state for persistence",
        "Add tests in crates/tui/tests/app_tests.rs for theme persistence, switching, and color application",
        "Update docs/usage.md with a 'Color Themes' section explaining available schemes and how to switch via 't' in the settings screen",
        "Ensure Default theme matches current hardcoded colors exactly for backward compatibility",
        "Run make ci to verify all tests and UI snapshots pass after color refactoring"
      ],
      "notes": [
        "RQ-0083 (Settings screen) is already completed, allowing theme switching to be integrated directly into the existing Settings UI",
        "Consider making Theme fields optional to allow partial customization in the future",
        "HighContrast theme should prioritize accessibility with maximum color difference (e.g., Black/White)",
        "Default theme must perfectly replicate existing UI colors to avoid breaking user experience on upgrade"
      ],
      "request": "scan finding",
      "created_at": "2026-01-24T21:00:00Z",
      "updated_at": "2026-01-26T18:45:00Z",
      "depends_on": [],
      "custom_fields": {}
    },
    {
      "id": "RQ-0092",
      "status": "todo",
      "title": "Add CLI command result file save option",
      "priority": "medium",
      "tags": [
        "cli",
        "ux",
        "output"
      ],
      "scope": [
        "crates/cli/src/main.rs",
        "crates/cli/src/commands/search.rs",
        "crates/cli/src/commands/indexes.rs",
        "crates/cli/src/commands/jobs.rs",
        "crates/cli/src/commands/cluster.rs",
        "crates/cli/src/commands/apps.rs",
        "crates/cli/src/commands/saved_searches.rs",
        "crates/cli/src/commands/users.rs",
        "crates/cli/src/commands/health.rs",
        "crates/cli/src/commands/license.rs",
        "crates/cli/src/commands/kvstore.rs",
        "crates/cli/src/commands/logs.rs",
        "crates/cli/src/commands/internal_logs.rs",
        "crates/cli/src/commands/list_all.rs",
        "crates/cli/src/formatters.rs",
        "crates/cli/tests/",
        "docs/usage.md"
      ],
      "evidence": [
        "All 15 CLI commands use print!() or println!() for stdout output only (confirmed by grep search showing 33 print!/println! usages across commands/)",
        "Global --output <FORMAT> flag exists in main.rs:52-54 but only accepts format type (json, table, csv, xml), not file path",
        "No --output-file or --save flag exists in any CLI command (grep for 'output.*file|output_path|PathBuf' returns no matches)",
        "TUI has ExportSearchResults action with file path selection popup (crates/tui/src/action.rs:85), but CLI lacks equivalent functionality",
        "Users must redirect stdout manually: splunk-cli search 'query' > results.json, which provides no error feedback or progress indication",
        "docs/usage.md only documents --output <FORMAT> for format selection (lines 90, 184, 225, 228, 302, 305, 311), with no file save option mentioned"
      ],
      "plan": [
        "Add --output-file <FILE> global flag to Cli struct in crates/cli/src/main.rs (separate from existing --output <FORMAT> flag to avoid conflicts)",
        "Pass output_file Option<PathBuf> through run_command() to all command run() functions",
        "Create helper function in crates/cli/src/formatters.rs: write_to_file(content: &str, path: &Path, format: OutputFormat) -> Result<()> that creates file, writes content atomically, handles errors gracefully",
        "Update all 15 command run() functions (search, indexes, jobs, cluster, apps, saved_searches, users, health, license, kvstore, logs, internal_logs, list_all, config) to check if output_file is Some() and call write_to_file() instead of print!()",
        "When file output is used, print success message to stderr: 'Results written to <path>' with format info for user feedback",
        "Handle file write errors (permission denied, directory not found, disk full) with helpful error messages using anyhow::Context",
        "Add integration tests in crates/cli/tests/file_output_tests.rs for file output behavior: write success, overwrite existing file, permission denied, invalid directory path",
        "Update docs/usage.md with new --output-file flag documentation in global options section and example usage: 'splunk-cli search \"index=main\" --wait --output-file results.json'",
        "Run make ci to verify all existing tests still pass and new file output tests pass"
      ],
      "notes": [
        "Must use --output-file instead of reusing --output to avoid conflict with existing --output <FORMAT> flag which is widely used",
        "All 15 CLI commands need updating (grep shows 15 command files in crates/cli/src/commands/), not just search/indexes/jobs/cluster as originally scoped",
        "File writing should go through existing formatter logic (get_formatter(format)) to ensure consistent output formats (json/table/csv/xml)",
        "For JSON format, consider using serde_json::to_string_pretty() for human-readable output, but for CSV/XML use formatter output directly",
        "Print success/error messages to stderr (not stdout) to avoid contaminating piped output when users still want to use stdout redirection",
        "Atomic file write (write to temp file then rename) is preferred to avoid partial writes if process is interrupted"
      ],
      "request": "scan finding",
      "created_at": "2026-01-24T21:00:00Z",
      "updated_at": "2026-01-25T23:04:32Z",
      "depends_on": [],
      "custom_fields": {}
    },
    {
      "id": "RQ-0093",
      "status": "todo",
      "title": "Add CLI cancel/sigint handling for long-running operations",
      "priority": "medium",
      "tags": [
        "cli",
        "ux",
        "signal-handling"
      ],
      "scope": [
        "crates/cli/src/main.rs",
        "crates/cli/src/commands/search.rs",
        "crates/cli/Cargo.toml",
        "crates/cli/tests/",
        "docs/usage.md"
      ],
      "evidence": [
        "CLI search.rs:32-44 shows wait boolean passed to client.search() with no user-facing progress feedback or cancellation during long searches",
        "CLI main.rs:117-120 shows tokio::main runtime without any signal::ctrl_c() handler or cancellation token setup",
        "Grep search for 'ctrl_c|SIGINT|SIGTERM|signal' in crates/cli/ shows zero matches - no signal handling exists",
        "Client library wait_for_job in search.rs:228-244 uses tokio::time::sleep for polling but no cancellation support",
        "No tests for signal handling in crates/cli/tests/ (13 test files, none cover cancellation)",
        "Users see tokio panic errors when pressing Ctrl+C during async operations - no graceful shutdown",
        "TUI has similar issue noted in RQ-0066 cache: 'Tail loop runs infinitely; could add signal handling'",
        "list_all.rs shows tokio::time::timeout pattern (RQ-0099) that could be applied to search wait for cancellation"
      ],
      "plan": [
        "Add tokio::signal::ctrl_c() handler in crates/cli/src/main.rs that sets Arc<AtomicBool> cancellation flag",
        "Pass cancellation token (Arc<AtomicBool>) to all async command run() functions via CLI struct or run_command wrapper",
        "Update search.rs run() to use tokio::select! with both search future and ctrl_c() signal for concurrent cancellation",
        "Update all long-running commands (search with --wait, list_all, logs with --tail) to check cancellation token periodically",
        "Add graceful shutdown: on SIGINT, print 'Operation cancelled by user' to stderr, exit with code 130 (standard for Ctrl+C)",
        "Use anyhow::Context with 'cancelled by user' message for cancellation errors in Result types",
        "Add integration tests using tokio::time::timeout and tokio::spawn to simulate ctrl_c signal during async operations",
        "Add test 'test_search_cancellation' in crates/cli/tests/search_tests.rs: spawn search task, send simulated ctrl_c, verify graceful exit",
        "Update docs/usage.md with 'Cancellation' section explaining Ctrl+C behavior and graceful shutdown for long-running operations",
        "Run make ci to verify all existing tests pass after signal handling changes"
      ],
      "notes": [
        "tokio::signal::ctrl_c() is part of tokio standard library, no new dependency needed",
        "Use tokio::select! macro to race between operation completion and ctrl_c signal for clean cancellation",
        "Exit code 130 is standard Unix convention for SIGINT (128 + 2), matching curl and other CLIs",
        "Consider using tokio_util::sync::CancellationToken for more robust cancellation across spawned tasks",
        "Client library already has timeout support in wait_for_job (search.rs:228-244), could integrate cancellation with existing timeout logic",
        "list_all.rs timeout pattern (tokio::time::timeout wrapper) in RQ-0099 shows precedent for adding cancellation to async operations",
        "TUI has similar signal handling gap (RQ-0066 cache notes 'could add signal handling' for tail loop)",
        "Signal handling should apply to all long-running CLI commands, not just search: list_all (9 fetch ops), logs --tail, search --wait",
        "Print cancellation message to stderr to avoid contaminating stdout formatted output (RQ-0092 notes show stderr pattern for user feedback)"
      ],
      "request": "scan finding",
      "created_at": "2026-01-24T21:00:00Z",
      "updated_at": "2026-01-25T00:00:00Z",
      "depends_on": [],
      "custom_fields": {}
    },
    {
      "id": "RQ-0094",
      "status": "todo",
      "title": "Add performance tests for TUI search results rendering",
      "priority": "low",
      "tags": [
        "tui",
        "performance",
        "tests"
      ],
      "scope": [
        "crates/tui/src/ui/screens/search.rs",
        "crates/tui/tests/app_tests.rs"
      ],
      "evidence": [
        "Virtualization IS implemented in search.rs:100-119 using sliding window pattern (skip/take on visible range)",
        "Pagination IS implemented in app.rs:386-406 (maybe_fetch_more_results loads more data when within 10 items of end)",
        "search_scroll_offset field exists (app.rs:177) for tracking visible region",
        "search_results stored as Vec<Value> (app.rs:176) to support scrolling without re-fetching",
        "No performance tests exist for rendering with large result sets (grep in crates/tui/tests/ shows zero matches for 'virtual|performance')",
        "No snapshot tests exist for virtual window scrolling behavior"
      ],
      "plan": [
        "Add performance test in crates/tui/tests/app_tests.rs: test_search_rendering_with_large_dataset() - verify rendering time with 10, 100, 1000, 10000 results",
        "Add snapshot test in crates/tui/tests/app_tests.rs: test_virtual_window_scrolling() - verify only visible results are rendered with various scroll offsets",
        "Add snapshot test: test_pagination_trigger() - verify LoadMoreSearchResults action triggers at correct threshold (within 10 items of end)",
        "Measure actual rendering time in tests using std::time::Instant to verify O(1) rendering cost regardless of total result count",
        "Run make ci to verify all tests pass"
      ],
      "notes": [
        "Core virtualization work is complete - search.rs already implements sliding window rendering (lines 101-119)",
        "Pagination is implemented with maybe_fetch_more_results() method (app.rs:386-406)",
        "Task evidence originally claimed virtualization didn't exist, but investigation reveals it was already implemented",
        "Remaining work is test coverage only, not implementation",
        "Storing all results in Vec<Value> is intentional design for scrolling without re-fetching",
        "Initial task scope was implementation work, but actual gap is test coverage for performance guarantees"
      ],
      "request": "scan finding",
      "created_at": "2026-01-24T21:00:00Z",
      "updated_at": "2026-01-25T23:30:00Z",
      "depends_on": [],
      "custom_fields": {}
    },
    {
      "id": "RQ-0095",
      "status": "todo",
      "title": "Add TUI fuzzy search for saved searches and jobs",
      "priority": "low",
      "tags": [
        "tui",
        "search",
        "ux"
      ],
      "scope": [
        "crates/tui/src/app.rs",
        "crates/tui/src/ui/screens/saved_searches.rs",
        "crates/tui/src/ui/screens/jobs.rs",
        "crates/tui/src/action.rs",
        "crates/tui/Cargo.toml"
      ],
      "evidence": [
        "Saved searches screen has NO search or filter capability: handle_saved_searches_input (app.rs:1161-1226) only supports j/k navigation, Enter to run, r to refresh, screen navigation (1-9), q to quit, ? for help",
        "Jobs screen has substring filter (NOT fuzzy) via '/' key: EnterSearchMode action (action.rs:52) triggers filter mode, rebuild_filtered_indices() (app.rs:1863-1905) does substring matching using .contains() on SID and status fields",
        "No fuzzy matcher crate exists in crates/tui/Cargo.toml: dependencies list shows ratatui, crossterm, tokio, serde_json, serde, csv, anyhow, tracing, tracing-subscriber, tracing-appender, uuid - no nucleo-matcher, skim, or similar fuzzy matching library",
        "No fuzzy search action exists in action.rs: EnterSearchMode (line 52) is for substring filter, SearchInput (line 55) for filter input, ClearSearch (line 57) to clear filter - no EnterFuzzySearch or fuzzy-specific actions",
        "Users with many saved searches (100+) must navigate manually through list: no filtering capability means manual j/k navigation through entire list to find specific saved searches",
        "Jobs screen filter is substring-only: rebuild_filtered_indices() (app.rs:1874-1878) uses .contains() matching on job.sid.to_lowercase() and status strings ('done'/'running'), not fuzzy matching with scoring"
      ],
      "plan": [
        "Add nucleo-matcher crate to crates/tui/Cargo.toml (lightweight, actively maintained fuzzy matcher)",
        "Add EnterFuzzySearch mode action to crates/tui/src/action.rs to distinguish from existing EnterSearchMode (substring filter)",
        "Add fuzzy_match_result field and fuzzy_query field to App struct in app.rs to track fuzzy search state and active match",
        "Update handle_saved_searches_input in app.rs: add fuzzy search mode entry (Ctrl+F key), implement fuzzy search popup that filters saved searches by name with score-based ranking, display match results with highlighted text",
        "Update saved_searches.rs render: add fuzzy_match_highlight parameter to render matches with highlighted characters (bold/yellow for matched positions)",
        "Update handle_jobs_input in app.rs: add fuzzy search mode entry (Ctrl+F or reuse '/' with modifier), implement fuzzy search popup for jobs table that matches on SID and status with score display",
        "Update jobs.rs render: add fuzzy_match_results parameter to display fuzzy search results popup with scored matches and highlighted text",
        "Implement fuzzy search results popup in ui/popup.rs: new PopupType::FuzzySearchResults variant with match list, current query display, navigation controls (Enter to select, Esc to cancel)",
        "Add fuzzy search state management: toggle fuzzy mode with Ctrl+F, type query to filter matches in real-time, navigate results with j/k, select with Enter to jump to item",
        "Add tests in crates/tui/tests/app_tests.rs for fuzzy search: test_fuzzy_search_saved_searches (partial match scoring, exact match first), test_fuzzy_search_jobs (SID and status matching), test_fuzzy_search_empty_query (show all items), test_fuzzy_search_no_matches (empty results display)",
        "Update help popup in ui/popup.rs to document 'Ctrl+F: Fuzzy search' shortcut for Saved Searches and Jobs screens",
        "Run make ci to verify all tests pass after fuzzy search implementation"
      ],
      "notes": [],
      "request": "scan finding",
      "created_at": "2026-01-24T21:00:00Z",
      "updated_at": "2026-01-25T23:59:00Z",
      "depends_on": [],
      "custom_fields": {}
    },
    {
      "id": "RQ-0097",
      "status": "todo",
      "title": "Add TUI job re-run functionality",
      "priority": "medium",
      "tags": [
        "tui",
        "jobs",
        "ux"
      ],
      "scope": [
        "crates/tui/src/app.rs",
        "crates/tui/src/action.rs",
        "crates/tui/src/ui/screens/jobs.rs"
      ],
      "evidence": [
        "TUI Jobs screen can view and cancel/delete jobs but cannot re-run a job",
        "Users must copy SID from TUI, exit to CLI, and run search command with saved query",
        "No 'Re-run job' action or keyboard shortcut exists",
        "Job re-run is a common Splunk workflow for iterating on queries"
      ],
      "plan": [
        "Add ReRunJob(String) action to crates/tui/src/action.rs",
        "Implement re-run by using job's saved search query or extracting query from job details",
        "Add keyboard shortcut (e.g., 'r' key) in Jobs screen to trigger re-run",
        "Add confirmation popup for re-run action with job details summary",
        "Update handle_jobs_input in app.rs to map 'r' key to ReRunJob action when on a job row",
        "Add side_effects handler for ReRunJob (creates new search job with same query)",
        "Add tests for job re-run (valid SID, not found job, re-run success)",
        "Update help popup to document re-run shortcut",
        "Run make ci to verify all tests pass"
      ],
      "notes": [],
      "request": "scan finding",
      "created_at": "2026-01-24T21:00:00Z",
      "updated_at": "2026-01-24T21:00:00Z",
      "depends_on": [],
      "custom_fields": {}
    },
    {
      "id": "RQ-0098",
      "status": "todo",
      "title": "Improve CLI search command to support job SID-based queries",
      "priority": "high",
      "tags": [
        "cli",
        "search",
        "jobs"
      ],
      "scope": [
        "crates/cli/src/commands/search.rs",
        "crates/cli/tests/search_tests.rs",
        "crates/cli/src/commands/jobs.rs"
      ],
      "evidence": [
        "CLI search command only takes raw SPL query string",
        "No way to execute search by job SID from CLI (useful for re-running/debugging)",
        "TUI has saved searches but CLI cannot reference saved searches by name",
        "Common workflow: user runs search in TUI, gets SID, wants to reference it later from CLI but cannot"
      ],
      "plan": [
        "Add --job-sid <SID> flag to search command (as alternative to <query>)",
        "If --job-sid provided, retrieve job results using get_search_results(sid, count, offset)",
        "Support both --job-sid and --query (mutually exclusive, or job-sid retrieves existing job results)",
        "Add integration tests for job SID search (valid SID, results loading, error handling)",
        "Update docs/usage.md with --job-sid documentation",
        "Consider synergy with RQ-0096 (re-run saved search that creates job)",
        "Run make ci to verify all tests pass"
      ],
      "notes": [],
      "request": "scan finding",
      "created_at": "2026-01-24T21:00:00Z",
      "updated_at": "2026-01-24T21:00:00Z",
      "depends_on": [],
      "custom_fields": {}
    }
  ]
}